<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED MQTT æ§åˆ¶æ¸¬è©¦</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "lit": "https://cdn.skypack.dev/lit@3",
                "lit/": "https://cdn.skypack.dev/lit@3/",
                "lit-html": "https://cdn.skypack.dev/lit-html@3",
                "lit-html/": "https://cdn.skypack.dev/lit-html@3/",
                "lit-element": "https://cdn.skypack.dev/lit@3",
                "lit-element/": "https://cdn.skypack.dev/lit@3/",
                "lit-element/lit-element.js": "https://cdn.skypack.dev/lit@3",
                "@lit/reactive-element": "https://cdn.skypack.dev/@lit/reactive-element@2",
                "@lit/reactive-element/": "https://cdn.skypack.dev/@lit/reactive-element@2/",
                "@lit/reactive-element/decorators": "https://cdn.skypack.dev/@lit/reactive-element@2/decorators",
                "@lit/reactive-element/decorators/": "https://cdn.skypack.dev/@lit/reactive-element@2/decorators/"
            }
        }
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        .led-panel {
            text-align: center;
            margin: 20px 0;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .api-examples {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
        }
        .mqtt-examples {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        h1, h2 {
            color: #333;
        }
        .success-info {
            background: #d4edda;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”´ LED MQTT æ§åˆ¶é¢æ¿</h1>
        
        <div class="success-info">
            <h3>âœ… ç³»çµ±å°±ç·’</h3>
            <p>MQTT LED å…ƒä»¶å·²è¼‰å…¥å®Œæˆï¼Œæ”¯æ´æœ¬åœ°æ§åˆ¶å’Œé ç«¯ MQTT æ§åˆ¶ï¼</p>
        </div>
        
        <div class="info">
            <h2>æœ¬åœ°æ§åˆ¶ API</h2>
            <p>æ‚¨å¯ä»¥åœ¨ç€è¦½å™¨çš„ console ä¸­ä½¿ç”¨ä»¥ä¸‹ API ä¾†æ§åˆ¶ LEDï¼š</p>
            <div class="api-examples">
                led.on()        // é»äº® LED<br>
                led.off()       // é—œé–‰ LED<br>
                led.toggle()    // åˆ‡æ› LED ç‹€æ…‹<br>
                led.setColor('blue')   // è¨­å®šé¡è‰²<br>
                led.setSize(50)        // è¨­å®šå¤§å° (ç›´å¾‘ px)<br>
                led.getState()         // å–å¾—ç›®å‰ç‹€æ…‹
            </div>
        </div>

        <div class="info">
            <h2>ğŸŒ MQTT é ç«¯æ§åˆ¶</h2>
            <p>ç™¼é€ MQTT è¨Šæ¯åˆ°ä»¥ä¸‹ topic å³å¯é ç«¯æ§åˆ¶ LEDï¼š</p>
            <div class="mqtt-examples">
                Topic: led/command<br>
                è¨Šæ¯æ ¼å¼ (ç´”å­—ä¸²):<br>
                â€¢ on() - é–‹å•Ÿ LED<br>
                â€¢ off() - é—œé–‰ LED<br>
                â€¢ toggle() - åˆ‡æ›ç‹€æ…‹<br>
                â€¢ setColor('blue') - è¨­å®šé¡è‰²<br>
                â€¢ setSize(60) - è¨­å®šå¤§å°<br>
                â€¢ getState() - å–å¾—ç‹€æ…‹
            </div>
        </div>

        <div class="led-panel">
            <h2>MQTT LED å…ƒä»¶</h2>
            <led-light id="myLed" color="red" diameter="40" mqtt-sub="led"></led-light>
            <div id="status" class="status">æ­£åœ¨è¼‰å…¥å…ƒä»¶...</div>
            <p>é»æ“Š LED å¯ä»¥åˆ‡æ›é–‹é—œç‹€æ…‹</p>
        </div>
    </div>

    <script type="module">
        // ä¸»è¦åˆå§‹åŒ–å‡½æ•¸
        async function initializeApp() {
            console.log('ğŸ”„ é–‹å§‹è¼‰å…¥ LED å…ƒä»¶...');
            
            try {
                // å‹•æ…‹è¼‰å…¥ LED å…ƒä»¶
                await import('./led-light.js');
                console.log('âœ… LED å…ƒä»¶è¼‰å…¥æˆåŠŸ');
                
                // ç­‰å¾…ä¸€ä¸‹è®“å…ƒä»¶è¨»å†Šå®Œæˆ
                await new Promise(resolve => setTimeout(resolve, 200));
                
                setupLedAPI();
                
            } catch (error) {
                console.error('âŒ LED å…ƒä»¶è¼‰å…¥å¤±æ•—:', error);
                const statusElement = document.getElementById('status');
                if (statusElement) {
                    statusElement.textContent = `âŒ å…ƒä»¶è¼‰å…¥å¤±æ•—: ${error.message}`;
                    statusElement.classList.add('error');
                }
            }
        }
        
        // è¨­å®š LED API
        function setupLedAPI() {
            console.log('ğŸš€ é–‹å§‹åˆå§‹åŒ– LED API...');
            
            const ledElement = document.getElementById('myLed');
            
            if (!ledElement) {
                console.error('âŒ æ‰¾ä¸åˆ° LED å…ƒä»¶');
                const statusElement = document.getElementById('status');
                if (statusElement) {
                    statusElement.textContent = 'âŒ æ‰¾ä¸åˆ° LED å…ƒä»¶';
                    statusElement.classList.add('error');
                }
                return;
            }
            
            console.log('ğŸ“± LED å…ƒä»¶æ‰¾åˆ°ï¼Œè¨­å®šä¸­...', ledElement);
            
            // å»ºç«‹å…¨åŸŸ LED API ç‰©ä»¶ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
            window.led = {
                on: () => {
                    try {
                        if (typeof ledElement.turnOn === 'function') {
                            ledElement.turnOn();
                        } else {
                            ledElement.on = true;
                        }
                        console.log('âœ… LED å·²é»äº®');
                    } catch (error) {
                        console.error('âŒ é–‹å•Ÿ LED å¤±æ•—:', error);
                    }
                },
                
                off: () => {
                    try {
                        if (typeof ledElement.turnOff === 'function') {
                            ledElement.turnOff();
                        } else {
                            ledElement.on = false;
                        }
                        console.log('ğŸ”´ LED å·²é—œé–‰');
                    } catch (error) {
                        console.error('âŒ é—œé–‰ LED å¤±æ•—:', error);
                    }
                },
                
                toggle: () => {
                    try {
                        if (typeof ledElement.toggle === 'function') {
                            ledElement.toggle();
                        } else {
                            ledElement.on = !ledElement.on;
                        }
                        console.log(`ğŸ”„ LED å·²${ledElement.on ? 'é»äº®' : 'é—œé–‰'}`);
                    } catch (error) {
                        console.error('âŒ åˆ‡æ› LED å¤±æ•—:', error);
                    }
                },
                
                setColor: (color) => {
                    try {
                        if (typeof ledElement.setColor === 'function') {
                            ledElement.setColor(color);
                        } else {
                            ledElement.color = color;
                        }
                        console.log(`ğŸ¨ LED é¡è‰²å·²è¨­å®šç‚º: ${color}`);
                    } catch (error) {
                        console.error('âŒ è¨­å®šé¡è‰²å¤±æ•—:', error);
                    }
                },
                
                setSize: (diameter) => {
                    try {
                        if (typeof ledElement.setSize === 'function') {
                            ledElement.setSize(diameter);
                        } else {
                            ledElement.diameter = diameter;
                        }
                        console.log(`ğŸ“ LED å¤§å°å·²è¨­å®šç‚º: ${diameter}px`);
                    } catch (error) {
                        console.error('âŒ è¨­å®šå¤§å°å¤±æ•—:', error);
                    }
                },
                
                getState: () => {
                    try {
                        let state;
                        if (typeof ledElement.getState === 'function') {
                            state = ledElement.getState();
                        } else {
                            state = {
                                on: ledElement.on,
                                color: ledElement.color,
                                diameter: ledElement.diameter
                            };
                        }
                        console.log('ğŸ“Š LED ç›®å‰ç‹€æ…‹:', state);
                        return state;
                    } catch (error) {
                        console.error('âŒ å–å¾—ç‹€æ…‹å¤±æ•—:', error);
                        return null;
                    }
                }
            };
            
            // ç›£è½ LED è®ŠåŒ–äº‹ä»¶
            ledElement.addEventListener('led-change', (event) => {
                console.log('ğŸ“¡ LED ç‹€æ…‹è®ŠåŒ–:', event.detail);
            });
            
            // ç›£è½ MQTT é€£æ¥äº‹ä»¶
            ledElement.addEventListener('mqtt-connected', (event) => {
                console.log('ğŸŒ MQTT é€£æ¥æˆåŠŸ:', event.detail);
                const statusElement = document.getElementById('status');
                if (statusElement) {
                    statusElement.textContent = `âœ… MQTT å·²é€£æ¥ (Device: ${event.detail.deviceId})`;
                    statusElement.style.background = '#d4edda';
                    statusElement.style.borderColor = '#c3e6cb';
                    statusElement.classList.remove('error');
                }
            });
            
            // ç›£è½ MQTT éŒ¯èª¤äº‹ä»¶
            ledElement.addEventListener('mqtt-error', (event) => {
                console.error('âŒ MQTT é€£æ¥éŒ¯èª¤:', event.detail.error);
                const statusElement = document.getElementById('status');
                if (statusElement) {
                    statusElement.textContent = `âŒ MQTT é€£æ¥å¤±æ•—: ${event.detail.error}`;
                    statusElement.style.background = '#f8d7da';
                    statusElement.style.borderColor = '#f5c6cb';
                    statusElement.classList.add('error');
                }
            });
            
            // åˆå§‹ç‹€æ…‹æª¢æŸ¥
            const statusElement = document.getElementById('status');
            if (ledElement.mqttSub) {
                console.log('ğŸŒ MQTT åŠŸèƒ½å·²å•Ÿç”¨, topic:', ledElement.mqttSub);
                if (statusElement) {
                    statusElement.textContent = 'ğŸ”— æ­£åœ¨é€£æ¥ MQTT...';
                }
            } else {
                console.log('âš ï¸ MQTT åŠŸèƒ½æœªå•Ÿç”¨');
                if (statusElement) {
                    statusElement.textContent = 'âš ï¸ MQTT åŠŸèƒ½æœªå•Ÿç”¨ï¼ˆåƒ…æœ¬åœ°æ§åˆ¶ï¼‰';
                    statusElement.style.background = '#fff3cd';
                    statusElement.style.borderColor = '#ffeaa7';
                }
            }
            
            console.log('ğŸ‰ LED API å·²æº–å‚™å°±ç·’ï¼');
            console.log('ğŸ”´ æœ¬åœ°æ§åˆ¶æŒ‡ä»¤ï¼š');
            console.log('  led.on() - é»äº® LED');
            console.log('  led.off() - é—œé–‰ LED');
            console.log('  led.toggle() - åˆ‡æ›ç‹€æ…‹');
            console.log('  led.setColor("blue") - è¨­å®šé¡è‰²');
            console.log('  led.setSize(60) - è¨­å®šå¤§å°');
            console.log('  led.getState() - æŸ¥çœ‹ç‹€æ…‹');
            console.log('ğŸŒ MQTT æ§åˆ¶ï¼šç™¼é€è¨Šæ¯åˆ° led/command topic');
        }
        
        // ç­‰å¾… DOM è¼‰å…¥å®Œæˆå¾Œå•Ÿå‹•
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html> 